Insert into [dbo].[fld_Multi_FieldValue]
					(FieldID,
					RecID,
					FieldVal)
select  ffv.FieldID,
		ffv.RecID,
		[dbo].[ufn_Adapt_ConvertValue](ffv.FieldID,ffv.FieldVal) FieldVal
		from	fld_Field_Value ffv 
		inner join fld_Field ff on ff.FieldID = ffv.FieldID and ff.NumberOfValues = 2

update fld_Field_Value
set FieldVal = [dbo].[ufn_Adapt_ConvertValue](FieldID,FieldVal)

--begin update transaction

declare			@TableID				int,
				@RecID					bigint,
				@CountLoop				int,
				@TransactionSQL			nvarchar(max)

set				@TransactionSQL = 'BEGIN TRANSACTION '
set				@CountLoop		= 0

declare Cur cursor local for
select	distinct
		f.TableID,
		fv.RecID 
		from [dbo].[fld_Field_Value] fv
		inner join [dbo].[fld_Field] f
		on	fv.FieldID = f.FieldID
		where TableID in (1,2,3,5,6)
open Cur

FETCH NEXT FROM Cur INTO @TableID, @RecID

while ( @@FETCH_STATUS = 0 )
begin

declare			@PKFieldName			varchar(255),
				@Delim					varchar(5),
				@TableName				varchar(255),
				@Sql					nvarchar(max),
				@ModuleID				int

				set	@Delim						= ' '
				set @Sql						= ' '

		select	@TableName				= mt.PhysicalName,
				@PKFieldName			= mt.PKFieldName,
				@ModuleID				= mt.ModuleID

				from	mdl_Table mt (nolock)

		where	mt.TableID				= @TableID
declare	@UpdateFields		varchar(max)  = ''

		--1.1 Get field val
		select	@UpdateFields		= @UpdateFields + @Delim + '[' + ff.FieldName + ']' + ' = ' + 
										(case	when ff.FieldTypeID = 6 and isnull(FieldMemo,'') = '' then 
												'null'
											when ff.FieldTypeID = 6 then 
												(' ''' + FieldMemo + ''' ')
											when isnull(FieldVal,'') = '' then
												'null'
											else
												(' ''' + FieldVal + ''' ')
										end) + ' ',
				@Delim				= ','
			
		from	[dbo].[fld_Field_Value] fv

		inner join fld_Field ff (nolock)
			on	ff.FieldID			= fv.FieldID
			and	ff.FieldName		not in ('CreatedDate', 'CreatedBy', 'ModifiedDate', 'ModifiedBy')
			and ff.ModuleID			= @ModuleID

		where (ff.FieldTypeID		<> 12
			or ff.NumberOfValues	<> 2)
			and RecID = @RecID

			--1.2 Update data to table
			set	@Sql					= 
			' update	dbo.' + @TableName + 
			' set	' + @UpdateFields + 
			' where	' + @PKFieldName + ' = ' + convert(varchar, @RecID)
			--select  @Sql
			if(@UpdateFields is not null and LEN(LTRIM(RTRIM(@UpdateFields))) > 0)
			begin
				if(@CountLoop = 1000)
				begin
					set @TransactionSQL = @TransactionSQL + ' COMMIT'
					begin try
						exec (@TransactionSQL)	
					end try
					begin catch
						--select @Sql
					end catch
				end
				else begin
					set @TransactionSQL = @TransactionSQL + @Sql + ' '
				end
			end
set			@CountLoop		= @CountLoop + 1
FETCH NEXT FROM Cur INTO @TableID, @RecID
end
CLOSE Cur 
DEALLOCATE Cur 

delete from [dbo].[fld_Field_Value]

 